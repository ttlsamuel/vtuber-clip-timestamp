#Expand to see details
'''
PROJECT DESCRIPTION:
We are trying to find the timestamp of a frame in a vtuber stream,
which matches a specific frame from a vtuber clip


PROJECT PROGRESS:
We can now use this programme to find the matching picture from a bunch of images
'''

# necessary imports
from datetime import datetime # for checking run time
start_time = datetime.now() # for checking run time
import os
import cv2
import imutils
import numpy as np

# frame from the clip
img1 = cv2.imread(r"C:\Users\user\Desktop\clip img\main.jpg")
img1 = cv2.resize(img1, (1980,1080))

# stream frames path
path = r'C:\Users\user\Pictures\hajime'

most_similar_pixelDiff_num = float("inf")
most_matching_frame = ""


# looping over frames and return the one that's most similar
for filename in os.listdir(path):
    filename = str(filename)
    #BEWARE OF the format of the stream frames
    img2 = cv2.imread(path + '\\' + filename)
    img2 = cv2.resize(img2, (1980,1080))

    gray1 = cv2.cvtColor(img1, cv2.COLOR_BGR2GRAY)
    gray2 = cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)

    diff = cv2.absdiff(gray1, gray2)

    #determining if the current frame is better than all previous frames
    if diff.sum() < most_similar_pixelDiff_num:
        most_similar_pixelDiff_num = diff.sum()
        most_matching_frame = filename


# results
print("The most matching frame is: " + most_matching_frame)
print("The number of different pixel(s) is: " + str(most_similar_pixelDiff_num))

# for checking run time
end_time = datetime.now()
print('Duration: {}'.format(end_time - start_time))




